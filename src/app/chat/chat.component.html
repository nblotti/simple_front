<div class="d-flex flex-column justify-content-end h-100">
  <div class="flex-grow-1 overflow-auto" #scrollMe>
    <table class="table table-borderless table_messages">
      <tbody>
        @for (message of this.screenReadyMessage(); track message.id) {
          <tr class=".bg-transparent message_row">
            <td class="chat_icon_content ">
              @if (message.role == "assistant") {
                <img class="chat_icon chat_assistant_icon">
              } @else {
                <img class="chat_icon chat_user_icon">
              }
            </td>
            <td class="chat_text_content">
              <div class="content">
                <div>
                  <pre [appHighlight]=message.content.toString()></pre>
                </div>
                <div class="accordion accordion-flush" id="accordionFlushExample"
                     [style.display]="message.sources.length==0?'none':'normal'">
                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                              [attr.data-bs-target]="'#collapseId_'+message.id" aria-expanded="false"
                              [attr.aria-controls]="'collapseId_' + message.id">

                        Sources
                      </button>
                    </h2>
                    <div [id]="'collapseId_' + message.id" class="accordion-collapse collapse"
                         data-bs-parent="#accordionFlushExample">
                      <div class="accordion-body">
                        @for (source of message.sources; track source) {
                          <a href="" (click)="displaySource($event,  source.blob_id, source.page, source.text)">Document
                            : {{ source.file_name }}
                            page : {{ source.page }}</a><br>
                        }
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </td>
            <td>
              <button
                type="button"
                tabindex="0"
                class="btn btn-sm btn-minimal btn-neutral code-sample-copy-float"
                aria-label="Copy"
                appCopyButton
                [textToCopy]="message.content.toString()"> <!-- Text to be copied -->
                <span class="btn-label-wrap">
    <span class="btn-node start-node">
      <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor" viewBox="0 0 24 24"
           class="animate-in">
        <path fill-rule="evenodd"
              d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2V5Zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1v2ZM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1H5Z"
              clip-rule="evenodd"></path>
      </svg>
    </span>
  </span>
              </button>
            </td>
          </tr>
        }

      </tbody>
    </table>
  </div>
  <div class="inputcontent">
    <textarea class="form-control chat_input_component" [(ngModel)]="inputMessage" (keyup)="onKeyUp($event)"
              rows="3"
              [disabled]="!statemanagerService.chatEnabled()"></textarea>
    <div class="button-group">
      <button class="chat_button" (click)="clearInput()"
              [disabled]="!statemanagerService.chatEnabled()">Clear
      </button>
      <button class="chat_button" (click)="runAction()" [disabled]="!statemanagerService.chatEnabled()">
        Run
      </button>
    </div>
  </div>
</div>





